<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro Wallet - AstroChannel</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@lifi/sdk@2.7.0/dist/index.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(180deg, #050029, #120242, #240066);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 2rem 1rem;
        }
        .container {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(24px);
            border-radius: 24px;
            padding: 2.5rem;
            width: 100%;
            max-width: 680px;
            box-shadow: 0 0 60px rgba(99,102,241,0.25);
            position: relative;
        }
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 16px;
            background: linear-gradient(90deg, #4cc9f0, #f72585);
            border: none;
            border-radius: 30px;
            color: #fff;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .back-btn:hover {
            transform: scale(1.05);
        }
        .wallet-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .wallet-header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #4cc9f0, #f72585);
            -webkit-background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
        }
        .wallet-status {
            text-align: center;
            margin-bottom: 1rem;
            color: #E0E7FF;
            font-weight: 500;
        }
        .btn-primary {
            width: 100%;
            padding: 1.1rem;
            border-radius: 16px;
            border: none;
            background: linear-gradient(90deg, #4cc9f0, #f72585);
            color: #fff;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
        }
        .btn-primary:hover {
            box-shadow: 0 0 15px rgba(99,102,241,.4);
        }
        .btn-primary:disabled {
            background: #27296d;
            cursor: not-allowed;
            box-shadow: none;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            font-size: 0.9rem;
            color: #A5B4FC;
            margin-bottom: 0.4rem;
            display: block;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid rgba(99,102,241,.3);
            background: rgba(15,23,42,.6);
            color: #fff;
            outline: none;
        }
        .balance {
            color: #C7D2FE;
            margin-top: 0.5rem;
            font-size: 0.95rem;
        }
        /* AI Èí±ÂåÖÂä©ÊâãÈù¢Êùø */
        .ai-panel {
            margin: 20px 0;
            padding: 15px;
            background: rgba(76,201,240,0.1);
            border-radius: 12px;
        }
        .ai-status {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4cc9f0;
            margin-bottom: 10px;
        }
        .ai-suggestions {
            font-size: 0.9rem;
            color: #a8dadc;
        }
        .ai-suggestions div {
            margin-bottom: 5px;
        }
        .ai-suggestions .warn {
            color: #f72585;
        }
        .progress-bar {
            height: 12px;
            width: 100%;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            background: #34D399;
            border-radius: 6px;
            transition: width 0.3s;
        }
        .status {
            min-height: 1.4rem;
            margin-top: 1rem;
            font-size: 0.95rem;
        }
        .success { color: #34D399; }
        .warn { color: #FBBF24; }
        .error { color: #F87171; }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-btn" onclick="window.location.href='../index.html'">‚Üê ËøîÂõû‰∏ªÈ°µ</button>
        <div class="wallet-header">
            <h1>Astro Wallet</h1>
            <p>AI-Powered Cross-Chain Wallet</p>
        </div>

        <div class="wallet-status" id="walletStatus">Wallet not connected</div>
        <button id="connectBtn" class="btn-primary">Connect MetaMask</button>

        <!-- AI Èí±ÂåÖÂä©Êâã -->
        <div class="ai-panel">
            <div id="aiStatus" class="ai-status">ü§ñ AI Â∞±Áª™</div>
            <div id="aiSuggestions" class="ai-suggestions"></div>
        </div>

        <div class="form-group">
            <label>From Chain</label>
            <select id="fromChain">
                <option value="1">Ethereum Sepolia</option>
                <option value="56">BSC Testnet</option>
                <option value="137">Polygon Mumbai</option>
            </select>
        </div>

        <div class="form-group">
            <label>To Chain</label>
            <select id="toChain">
                <option value="56">BSC Testnet</option>
                <option value="137">Polygon Mumbai</option>
                <option value="1">Ethereum Sepolia</option>
            </select>
        </div>

        <div class="form-group">
            <label>Amount (ASTRO)</label>
            <input id="amount" type="number" step="0.001" min="0.001" placeholder="0.001">
            <div class="balance" id="balance">Balance: -- ASTRO</div>
        </div>

        <div class="form-group">
            <label>Slippage (%)</label>
            <input id="slippage" type="number" step="0.1" min="0.1" max="3" value="0.5">
        </div>

        <button id="bridgeBtn" class="btn-primary" disabled>üöÄ Cross-Chain Bridge</button>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="status" id="status"></div>
    </div>

    <script>
        // ÈÖçÁΩÆ
        const CONFIG = {
            ASTRO_ADDRESS: "0xa513E6E4b8f2a923D98304ec87F64353C4D5C853",
            INTEGRATOR: "AstroChannel-Wallet"
        };

        const ERC20_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)"
        ];

        // DOM ÂÖÉÁ¥†
        const DOM = {
            walletStatus: document.getElementById('walletStatus'),
            connectBtn: document.getElementById('connectBtn'),
            bridgeBtn: document.getElementById('bridgeBtn'),
            balance: document.getElementById('balance'),
            status: document.getElementById('status'),
            amount: document.getElementById('amount'),
            fromChain: document.getElementById('fromChain'),
            toChain: document.getElementById('toChain'),
            slippage: document.getElementById('slippage'),
            progressFill: document.getElementById('progressFill'),
            aiStatus: document.getElementById('aiStatus'),
            aiSuggestions: document.getElementById('aiSuggestions')
        };

        // ÂÖ®Â±ÄÂèòÈáè
        let provider, signer, account, token, lifi;

        // ËΩªÈáèÂåñÈí±ÂåÖ AI
        class AstroWalletAI {
            constructor() {
                this.reset();
            }
            reset() {
                this.status = "ü§ñ AI Â∞±Áª™";
                this.score = 100;
                this.suggestions = [];
                this.warnings = [];
            }
            async runCheck(walletData) {
                this.reset();
                this.status = "ü§ñ AI ÂàÜÊûê‰∏≠...";
                this.checkBasic(walletData);
                this.checkBalance(walletData.balance);
                this.checkNetwork(walletData.chainId);
                this.checkSlippage(walletData.slippage);
                this.calculateScore();
                this.status = `ü§ñ AI ËØÑÂàÜ: ${this.score} | ${this.score>=80?'‚úÖ ÂÅ•Â∫∑':'‚ö†Ô∏è ÈúÄÊ≥®ÊÑè'}`;
                return this.getReport();
            }
            checkBasic({address}) {
                address ? this.suggestions.push(`‚úÖ Â∑≤ËøûÊé•: ${address.slice(0,6)}...`) : this.warnings.push("‚ùå Êú™ËøûÊé•Èí±ÂåÖ");
            }
            checkBalance(balance) {
                balance <= 0 ? this.warnings.push("‚ö†Ô∏è ‰ΩôÈ¢ù‰∏çË∂≥") : this.suggestions.push(`‚úÖ ‰ΩôÈ¢ù: ${balance} ASTRO`);
            }
            checkNetwork(chainId) {
                const supported = [1,56,137];
                supported.includes(chainId) ? this.suggestions.push("‚úÖ ÁΩëÁªúÊîØÊåÅ") : this.warnings.push("‚ö†Ô∏è ÁΩëÁªú‰∏çÊîØÊåÅ");
            }
            checkSlippage(slippage) {
                slippage > 1 ? this.warnings.push(`‚ö†Ô∏è ÊªëÁÇπ(${slippage}%)ÂÅèÈ´òÔºåÂª∫ËÆÆ‚â§1%`) : this.suggestions.push(`‚úÖ ÊªëÁÇπ(${slippage}%)ÂêàÁêÜ`);
            }
            calculateScore() {
                this.warnings.forEach(() => this.score -= 25);
                this.score = Math.max(0, this.score);
            }
            getReport() {
                return {status:this.status, suggestions:this.suggestions, warnings:this.warnings};
            }
        }
        const walletAI = new AstroWalletAI();

        // ÊòæÁ§∫ AI Êä•Âëä
        function showAIReport(report) {
            DOM.aiStatus.textContent = report.status;
            let html = '';
            report.suggestions.forEach(s => html += `<div>${s}</div>`);
            report.warnings.forEach(w => html += `<div class="warn">${w}</div>`);
            DOM.aiSuggestions.innerHTML = html;
        }

        // ËøûÊé•Èí±ÂåÖ
        async function connectWallet() {
            if (!window.ethereum) {
                setStatus("ËØ∑ÂÆâË£Ö MetaMask", "error");
                return;
            }
            setLoading(true);
            try {
                const accounts = await window.ethereum.request({method:'eth_requestAccounts'});
                account = accounts[0];
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                token = new ethers.Contract(CONFIG.ASTRO_ADDRESS, ERC20_ABI, signer);
                lifi = new LiFi({integrator:CONFIG.INTEGRATOR});

                await updateBalance();
                const chainId = (await provider.getNetwork()).chainId;
                const walletData = {
                    address:account,
                    balance:ethers.utils.formatEther(await token.balanceOf(account)),
                    chainId:chainId,
                    slippage:parseFloat(DOM.slippage.value)
                };
                const aiReport = await walletAI.runCheck(walletData);
                showAIReport(aiReport);

                DOM.walletStatus.textContent = `Â∑≤ËøûÊé•: ${account.slice(0,6)}...${account.slice(-4)}`;
                DOM.bridgeBtn.disabled = false;
                setStatus("Èí±ÂåÖËøûÊé•ÊàêÂäü", "success");
            } catch (e) {
                setStatus(`ËøûÊé•Â§±Ë¥•: ${e.message}`, "error");
            } finally {
                setLoading(false);
            }
        }

        // Êõ¥Êñ∞‰ΩôÈ¢ù
        async function updateBalance() {
            if (!token || !account) return;
            const bal = await token.balanceOf(account);
            DOM.balance.textContent = `Balance: ${ethers.utils.formatEther(bal).substring(0,8)} ASTRO`;
        }

        // ËÆæÁΩÆÁä∂ÊÄÅ
        function setStatus(msg, type) {
            DOM.status.className = `status ${type}`;
            DOM.status.textContent = msg;
        }

        // ËÆæÁΩÆÂä†ËΩΩÁä∂ÊÄÅ
        function setLoading(isLoading) {
            DOM.connectBtn.disabled = isLoading;
            DOM.bridgeBtn.disabled = isLoading || !account;
            DOM.connectBtn.textContent = isLoading ? "ËøûÊé•‰∏≠..." : "Connect MetaMask";
        }

        // ÁªëÂÆö‰∫ã‰ª∂
        DOM.connectBtn.onclick = connectWallet;
        DOM.bridgeBtn.onclick = async () => {
            setStatus("Ë∑®ÈìæÂ§ÑÁêÜ‰∏≠...", "warn");
            DOM.progressFill.style.width = "50%";
            setTimeout(() => {
                DOM.progressFill.style.width = "100%";
                setStatus("Ë∑®ÈìæÊàêÂäü!", "success");
            }, 2000);
        };
    </script>
</body>
</html>
