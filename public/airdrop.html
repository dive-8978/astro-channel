<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MemeAstro (MA) Airdrop | AstroChannel</title>
  <style>
    body { 
      background: #050512; 
      color: #e0f7ff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 20px 0;
      display: flex;
      justify-content: center;
    }
    .container {
      width: 100%;
      max-width: 630px;
      padding: 0 16px;
    }
    input:focus, button:focus { outline: 2px solid rgba(0,229,255,.5); outline-offset: 2px; }

    .token-link {
      text-align: center;
      margin-bottom: 16px;
    }
    .token-link a {
      color: #00e5ff;
      font-weight: 600;
      text-decoration: none;
    }
    .token-link a:hover {
      text-decoration: underline;
    }

    .task-card, .reward-card {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(0,229,255,0.3);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
    }
    .task-card:hover, .reward-card:hover {
      border-color: rgba(0,229,255,0.5);
    }
    .task-title, .reward-title {
      font-size: 19px;
      font-weight: 700;
      color: #00e5ff;
      margin-bottom: 10px;
    }
    .task-desc, .reward-desc {
      color: #a0c8d8;
      margin-bottom: 18px;
      line-height: 1.6;
    }

    .wallet-btn {
      position: relative;
      padding: 14px 28px;
      font-size: 16px;
      font-weight: 700;
      color: #000;
      background: #00e5ff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 18px rgba(0,229,255,0.4), 0 0 32px rgba(0,229,255,0.2);
      overflow: hidden;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }
    .wallet-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
      transition: left 0.6s ease;
    }
    .wallet-btn:hover {
      transform: translateY(-2px);
      background: #33ebff;
      box-shadow: 0 0 25px rgba(0,229,255,0.7), 0 0 45px rgba(0,229,255,0.4);
    }
    .wallet-btn:hover::before { left: 100%; }
    .wallet-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 28px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      border: none;
      text-align: center;
      width: 100%;
      box-sizing: border-box;
      font-size: 16px;
      text-decoration: none;
      background: #00e5ff;
      color: #000;
      box-shadow: 0 0 10px rgba(0,229,255,0.2);
    }
    .btn:hover:not(:disabled) {
      background: #33ebff;
      transform: translateY(-1px);
      box-shadow: 0 0 15px rgba(0,229,255,0.35);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .x-follow-btn, .bridge-btn {
      background: #1da1f2;
      color: white;
      margin-bottom: 14px;
      box-shadow: none;
    }
    .x-follow-btn:hover, .bridge-btn:hover {
      background: #1a91da;
    }

    .x-icon {
      width: 18px;
      height: 18px;
      margin-right: 8px;
      fill: currentColor;
    }
    input {
      width: 100%;
      box-sizing: border-box;
      padding: 14px 18px;
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(0,229,255,0.3);
      border-radius: 10px;
      color: white;
      font-size: 16px;
    }
    .claim-section {
      margin-top: 30px;
      text-align: center;
    }
    #claimAirdrop {
      max-width: 380px;
      padding: 18px;
      font-size: 19px;
    }
    .status {
      margin-top: 14px;
      color: #52c41a;
      font-weight: 500;
    }
    .gas-note {
      margin-top: 24px;
      text-align: center;
      color: #88aabb;
      font-size: 14px;
    }
    .stats {
      text-align: center;
      margin-bottom: 24px;
      color: #a0c8d8;
      font-size: 16px;
    }
    .tier-list {
      margin-top: 14px;
      padding-left: 22px;
      line-height: 1.8;
    }
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: rgba(0,229,255,0.1);
      border: 1px solid rgba(0,229,255,0.3);
      border-radius: 24px;
      color: #00e5ff;
      text-decoration: none;
      transition: all 0.2s;
    }
    .back-link:hover {
      background: rgba(0,229,255,0.2);
    }

    .balance-card {
      background: rgba(0,0,0,0.5);
      border: 1px solid #00e5ff;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      text-align: center;
      display: none;
    }
    .balance-title {
      font-size: 16px;
      color: #a0c8d8;
      margin-bottom: 8px;
    }
    .balance-amount {
      font-size: 28px;
      font-weight: bold;
      color: #00e5ff;
      margin-bottom: 8px;
    }
    .balance-lock {
      font-size: 14px;
      color: #52c41a;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="mb-8 text-center">
      <a href="https://www.astrochannel.one/" class="back-link">‚Üê Back to Home</a>
    </div>

    <div class="token-link">
      üîó Official Token Link:
      <a href="https://four.meme/bsc" target="_blank">Buy on Meme Platform</a>
    </div>

    <h1 class="text-4xl font-bold text-center mb-6 text-cyan-400">üöÄ MemeAstro (MA) Dual Airdrop</h1>
    <p class="text-center text-gray-300 mb-8">Choose <b>1 of 2 ways</b> to join ¬∑ First come, first served</p>

    <div class="balance-card" id="balanceCard">
      <div class="balance-title">Your Locked Balance</div>
      <div class="balance-amount" id="lockedAmount">0 MA</div>
      <div class="balance-lock" id="lockInfo">Locked for 180 days</div>
    </div>

    <div class="reward-card">
      <div class="reward-title">üèÜ Airdrop Tier Rewards</div>
      <div class="reward-desc">
        Rewards based on participation order:
        <div class="tier-list">
          ‚Ä¢ 1‚Äì1000: 1000 MA<br>
          ‚Ä¢ 1001‚Äì5000: 500 MA<br>
          ‚Ä¢ 5001‚Äì10000: 200 MA
        </div>
      </div>
    </div>

    <div class="reward-card">
      <div class="reward-title">üíé Long-Term ASTRO Airdrop</div>
      <div class="reward-desc">
        ‚Ä¢ Hold MA for <b>6 months</b><br>
        ‚Ä¢ Ratio: <b>100 MA = 1 ASTRO</b><br>
        ‚Ä¢ Auto-snapshot & auto-distribution<br>
        ‚Ä¢ ASTRO: Core token of AstroChannel Ecosystem
      </div>

      <a href="https://pancakeswap.finance/swap?outputCurrency=0xFf56bB1006962F24C40D71D1fe7FC6FcAC53a523" 
         target="_blank" class="wallet-btn">
        Buy MA
      </a>
    </div>

    <div class="stats">Current Participants: <span id="participants" class="text-cyan-400 font-semibold">1234</span></div>

    <div style="background: rgba(0,0,0,0.4); border:1px solid rgba(0,229,255,0.3); border-radius:16px; padding:24px; margin-bottom:24px;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div id="walletStatus" style="color:#a0c8d8;">Wallet not connected</div>
        <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
      </div>
    </div>

    <div class="task-card">
      <div class="task-title">1. Follow X Account</div>
      <div class="task-desc">Follow @Astro___Channel and verify</div>
      <a href="https://x.com/Astro___Channel" target="_blank" class="btn x-follow-btn">
        <svg class="x-icon" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg>
        Follow on X
      </a>
      <button class="btn verify-btn" data-task="x">I've Followed</button>
    </div>

    <div class="task-card">
      <div class="task-title">2. Complete Cross-Chain Transfer</div>
      <div class="task-desc">Complete 1 valid cross-chain transfer</div>
      <a href="https://www.astrochannel.one/bridge.html" target="_blank" class="btn bridge-btn">Go to Bridge</a>
      <button class="btn verify-btn" data-task="bridge">Verify Transfer</button>
    </div>

    <div class="claim-section">
      <button class="btn" id="claimAirdrop" disabled>Claim MA Airdrop</button>
      <div id="claimStatus" class="status"></div>
    </div>

    <div class="gas-note">Gas fees on BSC are paid by the user</div>
  </div>

  <script>
    let connectedWallet = null;
    let verifiedTasks = { x: false, bridge: false };
    
    const CONTRACT_ADDRESS = "0xfE3D128dbF5a0970D5EC0a9c1E75d9df25f2FA97";
    
    const CONTRACT_ABI = [
      {
        "inputs": [],
        "name": "distribute",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [{"internalType":"address","name":"account","type":"address"}],
        "name": "lockedBalanceOf",
        "outputs": [{"internalType":"uint256","name":"","type":"uint256"}],
        "type": "function"
      },
      {
        "inputs": [{"internalType":"address","name":"account","type":"address"}],
        "name": "releaseTimeOf",
        "outputs": [{"internalType":"uint256","name":"","type":"uint256"}],
        "type": "function"
      }
    ];

    window.addEventListener('DOMContentLoaded', async () => {
      if (window.ethereum) {
        try {
          const accounts = await window.ethereum.request({ method: 'eth_accounts' });
          if (accounts.length > 0) {
            connectedWallet = accounts[0];
            await initWallet();
          }
        } catch (err) {
          console.log('Wallet not connected on page load');
        }
      }
    });

    document.getElementById('connectBtn').addEventListener('click', async () => {
      if (!window.ethereum) {
        alert('Please install MetaMask to connect your wallet!');
        return;
      }
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        connectedWallet = accounts[0];
        await initWallet();
      } catch (err) {
        console.error(err);
        alert('Connection failed: ' + err.message);
      }
    });

    async function initWallet() {
      document.getElementById('walletStatus').textContent = `Connected: ${connectedWallet.slice(0,6)}...${connectedWallet.slice(-4)}`;
      document.getElementById('connectBtn').textContent = 'Connected';
      document.getElementById('connectBtn').disabled = true;
      
      await checkUserLockedBalance();
      checkClaimEnable();
    }

    async function checkUserLockedBalance() {
      try {
        const provider = new window.ethereum.providers.Web3Provider(window.ethereum);
        const contract = new window.ethereum.Contract(CONTRACT_ABI, CONTRACT_ADDRESS, provider);
        
        const lockedBalance = await contract.methods.lockedBalanceOf(connectedWallet).call();
        const releaseTime = await contract.methods.releaseTimeOf(connectedWallet).call();

        if (lockedBalance > 0) {
          document.getElementById('balanceCard').style.display = 'block';
          const maBalance = (lockedBalance / 1e18).toLocaleString();
          document.getElementById('lockedAmount').textContent = `${maBalance} MA`;
          
          const currentTime = Math.floor(Date.now() / 1000);
          const remainingSeconds = releaseTime - currentTime;
          
          if (remainingSeconds > 0) {
            const daysLeft = Math.ceil(remainingSeconds / 86400);
            document.getElementById('lockInfo').textContent = `üîí Locked for ${daysLeft} more days`;
            document.getElementById('claimAirdrop').textContent = '‚úÖ Already Claimed';
            document.getElementById('claimAirdrop').disabled = true;
            document.getElementById('claimAirdrop').style.background = '#666';
          } else {
            document.getElementById('lockInfo').textContent = '‚úÖ Unlocked!';
          }
          
          verifiedTasks.x = true;
          verifiedTasks.bridge = true;
        }
      } catch (error) {
        console.error("Error checking locked balance:", error);
      }
    }

    document.querySelectorAll('.verify-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        if (!connectedWallet) {
          alert('Please connect your wallet first!');
          return;
        }
        const task = btn.dataset.task;
        btn.textContent = 'Verifying...';
        btn.disabled = true;

        await new Promise(r => setTimeout(r, 1200));
        verifiedTasks[task] = true;
        btn.textContent = '‚úÖ Verified';
        btn.style.background = '#52c41a';
        checkClaimEnable();
      });
    });

    function checkClaimEnable() {
      const hasVerifiedTask = Object.values(verifiedTasks).some(v => v);
      document.getElementById('claimAirdrop').disabled = !hasVerifiedTask || !connectedWallet;
    }

    document.getElementById('claimAirdrop').addEventListener('click', async () => {
      const btn = document.getElementById('claimAirdrop');
      const status = document.getElementById('claimStatus');
      btn.textContent = 'Claiming...';
      btn.disabled = true;
      status.textContent = '';

      try {
        const provider = new window.ethereum.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        const contract = new window.ethereum.Contract(CONTRACT_ABI, CONTRACT_ADDRESS, signer);

        status.textContent = '‚è≥ Confirm in wallet...';
        const tx = await contract.methods.distribute().send({ from: connectedWallet });
        
        status.textContent = `‚úÖ Success! TX: ${tx.hash.slice(0,10)}...`;
        await checkUserLockedBalance();

      } catch (error) {
        console.error(error);
        if (error.code === 4001) {
          status.textContent = '‚ùå Transaction cancelled';
        } else {
          status.textContent = '‚ùå Claim failed: ' + error.message.slice(0, 60);
        }
        btn.textContent = 'Claim MA Airdrop';
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
