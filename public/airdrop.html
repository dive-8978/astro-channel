<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MemeAstro (MA) Triple Airdrop | AstroChannel</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    body { background:#050512; color:#e0f7ff; font-family: system-ui; }
    .neon { box-shadow:0 0 20px rgba(0,229,255,.25); }
    .task-card { background: rgba(0,0,0,0.4); border: 1px solid rgba(0,229,255,0.3); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
    .btn { width:100%; padding:12px; border-radius:10px; font-weight:600; }
    .btn-primary { background:#00e5ff; color:#000; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
  </style>
</head>

<body class="min-h-screen px-4 py-10 max-w-3xl mx-auto">

<h1 class="text-4xl font-bold text-center mb-4 text-cyan-400">ğŸš€ MemeAstro (MA) Triple Airdrop</h1>

<!-- å†…å®¹åŒºåŸŸçœç•¥ï¼ˆä¸ä½ ç»™çš„ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œä¸é‡å¤ï¼‰ -->

<script>
/**
 * ===============================
 * åŸºç¡€é…ç½®
 * ===============================
 */
const API_BASE = "https://api.yourdomain.com"; // â† åç«¯éƒ¨ç½²åæ”¹è¿™é‡Œ

let connectedWallet = null;
let verifiedTasks = { x:false, imei:false, bridge:false };

/**
 * ===============================
 * è¿æ¥é’±åŒ…
 * ===============================
 */
document.getElementById('connectBtn').onclick = async () => {
  if (!window.ethereum) return alert('Please install MetaMask');
  const [account] = await ethereum.request({ method: 'eth_requestAccounts' });
  connectedWallet = account;
  document.getElementById('walletStatus').innerText =
    `Connected: ${account.slice(0,6)}...${account.slice(-4)}`;
  document.getElementById('connectBtn').disabled = true;
  checkClaimEnable();
};

/**
 * ===============================
 * é€šç”¨ API è¯·æ±‚
 * ===============================
 */
async function post(url, data) {
  const res = await fetch(API_BASE + url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  return res.json();
}

/**
 * ===============================
 * ä»»åŠ¡éªŒè¯
 * ===============================
 */
document.querySelectorAll('.verify-btn').forEach(btn => {
  btn.onclick = async () => {
    if (!connectedWallet) return alert('Connect wallet first');
    const task = btn.dataset.task;
    btn.disabled = true;
    btn.innerText = "Verifying...";

    try {
      if (task === 'imei') {
        const imei = document.getElementById('imeiInput').value.trim();
        if (!/^\d{15}$/.test(imei)) throw 'Invalid IMEI';
        await post('/api/verify-imei', { wallet: connectedWallet, imei });
      }

      if (task === 'x') {
        await post('/api/verify-x', { wallet: connectedWallet });
      }

      if (task === 'bridge') {
        await post('/api/verify-bridge', { wallet: connectedWallet });
      }

      verifiedTasks[task] = true;
      btn.innerText = "âœ… Verified";
      btn.style.background = "#52c41a";
      checkClaimEnable();

    } catch (e) {
      alert(e);
      btn.disabled = false;
      btn.innerText = "Verify";
    }
  };
});

/**
 * ===============================
 * Claim çŠ¶æ€
 * ===============================
 */
function checkClaimEnable() {
  const ok = Object.values(verifiedTasks).some(v => v);
  document.getElementById('claimAirdrop').disabled = !(ok && connectedWallet);
}

/**
 * ===============================
 * Claim Airdropï¼ˆç­¾å + åˆçº¦ï¼‰
 * ===============================
 */
document.getElementById('claimAirdrop').onclick = async () => {
  const btn = document.getElementById('claimAirdrop');
  btn.disabled = true;
  btn.innerText = "Claiming...";

  try {
    // 1ï¸âƒ£ è·å–ç­¾å
    const { signature, amount, lockUntil } =
      await post('/api/claim', { wallet: connectedWallet });

    // 2ï¸âƒ£ è°ƒåˆçº¦ï¼ˆè¿™é‡Œåªç¤ºæ„ï¼Œåˆçº¦åœ°å€ä½ åé¢å¡«ï¼‰
    /*
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    const signer = provider.getSigner();
    const contract = new ethers.Contract(AIRDROP_CONTRACT, ABI, signer);
    await contract.claim(amount, lockUntil, signature);
    */

    document.getElementById('claimStatus').innerText =
      "âœ… Claimed! MA locked for 3 months";

    btn.innerText = "Claimed";

  } catch (e) {
    alert(e);
    btn.disabled = false;
    btn.innerText = "Claim MA Airdrop";
  }
};
</script>

</body>
</html>
