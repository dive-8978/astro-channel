<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AstroBridge - Global Super Chain</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.6.9/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background:radial-gradient(circle at 20% 20%,#050029,#2E007A);
  color:#fff;
  font-family:Arial;
  display:flex;
  justify-content:center;
  padding:40px 10px;
}
.container{
  background:rgba(255,255,255,0.05);
  padding:30px;
  border-radius:20px;
  width:100%;
  max-width:700px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  margin-top:10px;
  background:linear-gradient(90deg,#ff4500,#ff8c00);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}
.status{margin-top:10px;min-height:20px;}
.success{color:#32CD32;}
.error{color:#FF6347;}
.warn{color:#FFA500;}
input,select{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-top:5px;
}
</style>
</head>
<body>

<div class="container">
<h2>AstroBridge - Global Super Chain</h2>

<p id="walletStatus">Wallet not connected</p>
<button id="connectBtn">Connect Wallet</button>

<hr/>

<label>From Chain</label>
<select id="fromChain">
  <option value="1">Ethereum</option>
  <option value="56">BSC</option>
  <option value="137">Polygon</option>
</select>

<label>To Chain</label>
<select id="toChain">
  <option value="56">BSC</option>
  <option value="1">Ethereum</option>
  <option value="137">Polygon</option>
</select>

<label>Amount</label>
<input id="amount" type="number" placeholder="0.01"/>

<label>Slippage (%)</label>
<input id="slippage" type="number" value="1"/>

<div class="status" id="status"></div>
<button id="bridgeBtn" disabled>Cross-Chain Transfer</button>

</div>

<script>
const { ethers } = window;
const API_BASE = "http://45.76.150.100:3000";

let provider, signer, account;

const DOM = {
  walletStatus: document.getElementById("walletStatus"),
  connectBtn: document.getElementById("connectBtn"),
  bridgeBtn: document.getElementById("bridgeBtn"),
  fromChain: document.getElementById("fromChain"),
  toChain: document.getElementById("toChain"),
  amount: document.getElementById("amount"),
  slippage: document.getElementById("slippage"),
  status: document.getElementById("status")
};

async function connectWallet(){
  if(!window.ethereum){
    DOM.walletStatus.innerText="MetaMask not found";
    return;
  }
  provider=new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts",[]);
  signer=provider.getSigner();
  account=await signer.getAddress();
  DOM.walletStatus.innerText="Connected: "+account.slice(0,6)+"...";
  DOM.bridgeBtn.disabled=false;
}

async function realBridge(){
  try{
    const payload={
      account,
      amount:DOM.amount.value,
      fromChain:Number(DOM.fromChain.value),
      toChain:Number(DOM.toChain.value),
      slippage:Number(DOM.slippage.value)
    };

    DOM.status.innerText="Submitting intent...";
    DOM.status.className="status warn";

    const res=await fetch(API_BASE+"/intent/submit",{
      method:"POST",
      headers:{ "Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });

    const data=await res.json();

    if(!res.ok) throw new Error(data.message||"Bridge failed");

    DOM.status.innerText="✅ Intent submitted: "+data.intentId;
    DOM.status.className="status success";

  }catch(err){
    DOM.status.innerText="❌ "+err.message;
    DOM.status.className="status error";
  }
}

DOM.connectBtn.onclick=connectWallet;
DOM.bridgeBtn.onclick=realBridge;

</script>
</body>
</html>
